<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Zimbra | Треск и скрежет в моей голове]]></title>
  <link href="http://blog.alfss.net//blog/categories/zimbra/atom.xml" rel="self"/>
  <link href="http://blog.alfss.net//"/>
  <updated>2012-11-06T03:35:20+04:00</updated>
  <id>http://blog.alfss.net//</id>
  <author>
    <name><![CDATA[Sergey V. Kravchuk]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Zimbra + Graylisting]]></title>
    <link href="http://blog.alfss.net//post/2011/12/14/zimbra-plus-gralisting/"/>
    <updated>2011-12-14T01:25:00+04:00</updated>
    <id>http://blog.alfss.net//post/2011/12/14/zimbra-plus-gralisting</id>
    <content type="html"><![CDATA[<p>Я считаю, что серые списки это наиболее эффективный механизм противодействия спаму.
В OpenBSD я использовал spamd, но к сожалению он не портирован на дугие ОС и фаерволы(pf).</p>

<p>Начиная с 7.1 Zimbra поставляется вместе с <a href="http://www.policyd.org/">Policyd v2</a>. Это перловый демон осуществляющий Gralisting + SPF check + EHLO check.</p>

<h3>Собственно приступим к настройке. ("Смерть спаму!")</h3>

<!--more-->


<p>{% codeblock %}
su - zimbra
zmprov ms mail.example.net +zimbraServiceEnabled cbpolicyd
zmlocalconfig -e postfix_enable_smtpd_policyd=yes
zmprov mcf +zimbraMtaRestriction "check_policy_service inet:127.0.0.1:10031"
zmlocalconfig -e cbpolicyd_log_level=4
zmlocalconfig -e cbpolicyd_log_detail=modules,tracking,policies
zmlocalconfig -e cbpolicyd_module_accesscontrol=1 cbpolicyd_module_checkhelo=1 \
  cbpolicyd_module_checkspf=1 cbpolicyd_module_greylisting=1 cbpolicyd_module_quotas=1
zmmtactl restart
exit
{% endcodeblock %}</p>

<p>Да, это все, что требовалось для запуска демона и скрещивания его с postfix. :)</p>

<h3>Настраиваем веб морду.</h3>

<p>Добавим в конец  /opt/zimbra/conf/httpd.conf  следующие строчки:
{% codeblock %}
Alias /policyd /opt/zimbra/cbpolicyd/share/webui/</p>

<p><Directory /opt/zimbra/cbpolicyd/share/webui/></p>

<pre><code>Order Deny,Allow
Deny from all
Allow from 192.168.1.0/255.255.255.0
</code></pre>

<p></Directory>
{% endcodeblock %}</p>

<p>Заменем строку $DB_DSN в /opt/zimbra/cbpolicyd-2.0.10/share/webui/includes/config.php  на следующую:</p>

<p>{% codeblock lang:php %}
$DB_DSN="sqlite:/opt/zimbra/data/cbpolicyd/db/cbpolicyd.sqlitedb";
{% endcodeblock %}</p>

<p>Перезапустим апача который идет в комплекте с zimbra.
{% codeblock lang:bash %}
su - zimbra -c "zmapachectl restart"
{% endcodeblock %}</p>

<p>Теперь панель управления policyd доступна по адресу  http://mail.example.net:7780/policyd/index.php</p>

<p>Правда панель управления оставляет желать лучшего вплане UI, но это терпимо.</p>
]]></content>
  </entry>
  
</feed>
