<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: mail | Треск и скрежет в моей голове]]></title>
  <link href="http://blog.alfss.net//blog/categories/mail/atom.xml" rel="self"/>
  <link href="http://blog.alfss.net//"/>
  <updated>2012-11-06T03:35:20+04:00</updated>
  <id>http://blog.alfss.net//</id>
  <author>
    <name><![CDATA[Sergey V. Kravchuk]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Сохранение всей почты в один ящик Postfix + Dovecot]]></title>
    <link href="http://blog.alfss.net//post/2012/09/02/sokhranieniie-vsiei-pochty-v-odin-iashchik-postfix-plus-dovecot/"/>
    <updated>2012-09-02T18:39:00+04:00</updated>
    <id>http://blog.alfss.net//post/2012/09/02/sokhranieniie-vsiei-pochty-v-odin-iashchik-postfix-plus-dovecot</id>
    <content type="html"><![CDATA[<p>Мне потребовалось реализовать сохранение всей исходящей и входящей почты в один ящик на тестовом сервер.
Как SMTP  я выбрал Postfix за его простоту и Dovecot как imap сервер и сервер доставки.</p>

<p>Описывать как все ставить с нуля я не буду, опишу лишь основные моменты.</p>

<h3>Настройка Postfix</h3>

<!--more-->


<p>В master.cf описываем наш новый сервис:</p>

<p>{% codeblock lang:bash %}
dovecot  unix  -       n       n       -       -       pipe
   flags=DRhu user=webuser argv=/usr/lib/dovecot/deliver -d webuser
{% endcodeblock %}</p>

<p>Вся почта будет складываться в каталог пользователя webuser.</p>

<p>Устанавливаем службу dovecot(описанную выше) как дефолтную для доставки.</p>

<p>main.cf:
{% codeblock lang:bash %}
default_transport = dovecot
{% endcodeblock %}</p>

<h3>Теперь переходим к настройке dovecot.</h3>

<p>Описываем как и где смотреть пользователей (я выбрал хранение в файле).</p>

<p>{% codeblock lang:bash %}
passdb {
  driver = passwd-file
  args = scheme=plain-md5 username_format=%n /etc/dovecot/users
}</p>

<p>userdb {
  driver = passwd-file
  args = username_format=%n /etc/dovecot/users
}
{% endcodeblock %}</p>

<p>Будем хранить почту в формате Maildir. Указываем директорию и формат хранения.</p>

<p>{% codeblock lang:bash %}
mail_location = maildir:/srv/mail/%n
{% endcodeblock %}
<em>/srv/mail пренадлежит webuser(uid 2000:gid 2000)</em></p>

<p>Заключительный шаг. Описываем нашего пользователя (webuser) в файле /etc/dovecot/users</p>

<p>{% codeblock lang:bash %}
webuser:{plain}jagsjhdgajhsd:2000:2000::/home/webuser
{% endcodeblock %}</p>

<ul>
<li>webuser - имя пользователя</li>
<li>{plain}jagsjhdgajhsd - наш пароль в открытом виде</li>
<li>цыфры это uid и gid.</li>
</ul>

]]></content>
  </entry>
  
</feed>
